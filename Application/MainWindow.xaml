<Window x:Class="EditorApplication.MainWindow"
		xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:local="clr-namespace:EditorApplication"
		xmlns:NetworkUI="clr-namespace:NetworkUI;assembly=NetworkUI"
		xmlns:NetworkVM="clr-namespace:NetworkViewModel;assembly=NetworkViewModel"
		xmlns:Utils="clr-namespace:Utils;assembly=Utils"
		Title="MainWindow" Height="350" Width="525">
	
	<Window.Resources>
		
		<ResourceDictionary>
			
			<RoutedUICommand x:Key="CreateNode"/>
			<RoutedUICommand x:Key="DeleteNode"/>
			<RoutedUICommand x:Key="DeleteLink"/>
			
			<DataTemplate DataType="{x:Type NetworkVM:Node}">
				<DockPanel	Name="PART_DockPanel">
					<DockPanel.Background>
						<SolidColorBrush Color="{DynamicResource {x:Static SystemColors.ActiveBorderColorKey}}"/>
					</DockPanel.Background>
					<Border DockPanel.Dock="Top" Background="LightGray">
						<Label Content="{Binding Name}"/>
					</Border>
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="1*"/>
							<ColumnDefinition Width="1*"/>
						</Grid.ColumnDefinitions>
						<ItemsControl ItemsSource="{Binding InputConnectors}" Focusable="False"/>
						<ItemsControl ItemsSource="{Binding OutputConnectors}" Focusable="False" Grid.Column="1"/>
					</Grid>
				</DockPanel>
			</DataTemplate>
			
			<DataTemplate DataType="{x:Type NetworkVM:Connector}">
				<DockPanel>
					<NetworkUI:ConnectorItem Width="10" Height="10" DockPanel.Dock="Left"></NetworkUI:ConnectorItem>
					<Label Content="{Binding Path=Name}"/>
				</DockPanel>
			</DataTemplate>
			
			<DataTemplate DataType="{x:Type NetworkVM:OutputConnector}">
				<DockPanel>
					<NetworkUI:ConnectorItem Width="10" Height="10" DockPanel.Dock="Right"></NetworkUI:ConnectorItem>
					<Label Content="{Binding Path=Name}"/>
				</DockPanel>
			</DataTemplate>
			
			<DataTemplate DataType="{x:Type NetworkVM:Link}">
				<local:FancyLink Link="{Binding}" SourceHotspot="{Binding SourceHotspot}" DestinationHotspot="{Binding DestinationHotspot}"/>
				<!--
				<Canvas>
					<Line X1="{Binding Path=SourceHotspot.X}"
						  Y1="{Binding Path=SourceHotspot.Y}"
						  X2="{Binding Path=DestinationHotspot.X}"
						  Y2="{Binding Path=DestinationHotspot.Y}"
						  StrokeThickness="5">
						<Line.Stroke>
							<SolidColorBrush Color="{Binding Path=IsSelected,Converter={Utils:BoolToColorConverter},ConverterParameter=Aqua;Blue}"/>
						</Line.Stroke>
					</Line>
					<Line X1="{Binding Path=GhostSourceHotspot.X}"
						  Y1="{Binding Path=GhostSourceHotspot.Y}"
						  X2="{Binding Path=GhostDestinationHotspot.X}"
						  Y2="{Binding Path=GhostDestinationHotspot.Y}"
						  StrokeThickness="2"
						  Visibility="{Binding Path=IsGhostVisible, Converter={Utils:BoolToVisibilityConverter}}">
						<Line.Stroke>
							<SolidColorBrush Color="{Binding Path=IsGhostAccepted,Converter={Utils:BoolToColorConverter},ConverterParameter=DarkGreen;Red}"/>
						</Line.Stroke>
					</Line>
					<NetworkUI:EndpointItem Hotspot="{Binding Path=SourceHotspot}" Side="{x:Static NetworkVM:ConnectorType.Source}"/>
					<NetworkUI:EndpointItem Hotspot="{Binding Path=DestinationHotspot}" Side="{x:Static NetworkVM:ConnectorType.Destination}"/>
				</Canvas>
				-->
			</DataTemplate>

			<!-- Bind NodeItem properties to viewmodel -->
			<Style	TargetType="{x:Type NetworkUI:NodeItem}">
				<Setter Property="X" Value="{Binding X}"/>
				<Setter Property="Y" Value="{Binding Y}" />
				<Setter Property="ZIndex" Value="{Binding ZIndex}" />
				<Setter Property="IsSelected" Value="{Binding IsSelected}" />
			</Style>
			
			<Style	TargetType="{x:Type NetworkUI:LinkItem}">
				<Setter Property="IsSelected" Value="{Binding IsSelected}"/>
			</Style>

			<Style	TargetType="{x:Type NetworkUI:ConnectorItem}">
				<Setter Property="Hotspot" Value="{Binding Hotspot, Mode=OneWayToSource}" />
				<Setter Property="Template">
					<Setter.Value>
						<ControlTemplate TargetType="{x:Type NetworkUI:ConnectorItem}">
							<Ellipse Stroke="Black" StrokeThickness="1" Fill="{TemplateBinding Background}"/>
						</ControlTemplate>
					</Setter.Value>
				</Setter>
				<Style.Triggers>
					<DataTrigger Binding="{Binding Type}" Value="{x:Static NetworkVM:ConnectorType.Input}">
						<Setter Property="Background" Value="Lime"/>
					</DataTrigger>
					<DataTrigger Binding="{Binding Type}" Value="{x:Static NetworkVM:ConnectorType.Output}">
						<Setter Property="Background" Value="Red"/>
					</DataTrigger>
				</Style.Triggers>
			</Style>
			
			<Style	TargetType="{x:Type NetworkUI:EndpointItem}">
				<Setter Property="Template">
					<Setter.Value>
						<ControlTemplate TargetType="{x:Type NetworkUI:EndpointItem}">
							<Path Fill="White" Stroke="Black" StrokeThickness="1">
								<Path.Data>
									<EllipseGeometry Center="0,0" RadiusX="4" RadiusY="4"/>
								</Path.Data>
							</Path>
						</ControlTemplate>
					</Setter.Value>
				</Setter>
			</Style>
			
		</ResourceDictionary>
		
	</Window.Resources>
	
	<Window.DataContext>
		<local:ApplicationViewModel/>
	</Window.DataContext>
	
	<Grid>
		<NetworkUI:NetworkView	x:Name="PART_NetworkView"
								NodesSource="{Binding Path=Network.Nodes}"
								ConnectionsSource="{Binding Path=Network.Links}"
								ConnectorLinkDragStarted="NetworkView_ConnectionDragStarted"
								ConnectorLinkDragging="NetworkView_ConnectionDragging"
								ConnectorLinkDragCompleted="NetworkView_ConnectionDragCompleted"
								ConnectorLinkFeedbackQuery="NetworkView_ConnectorLinkFeedbackQuery"
								ConnectorLinkFeedbackResult="NetworkView_ConnectorLinkFeedbackResult"
								EndpointLinkDragStarted="NetworkView_EndpointLinkDragStarted"
								EndpointLinkDragging="NetworkView_EndpointLinkDragging"
								EndpointLinkDragCompleted="NetworkView_EndpointLinkDragCompleted"
								EndpointLinkFeedbackQuery="NetworkView_EndpointLinkFeedbackQuery"
								EndpointLinkFeedbackResult="NetworkView_EndpointLinkFeedbackResult">
		</NetworkUI:NetworkView>
		<Button VerticalAlignment="Bottom" Height="23" Click="Button_Click"></Button>
	</Grid>
	
</Window>
